<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Affan Arts | Strategic Billing System V8.2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;900&display=swap" rel="stylesheet">
    <style>
        :root { --cyan: #00f2ff; --green: #00ffaa; --bg: #020202; }
        body { background-color: var(--bg); color: white; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        
        /* CUSTOM CURSOR - Only visible on Desktop */
        #cursor { 
            width: 15px; height: 15px; border: 2px solid var(--cyan); border-radius: 50%; 
            position: fixed; pointer-events: none; z-index: 9999; 
            transition: transform 0.1s ease; mix-blend-mode: difference; 
            display: none; /* Hidden by default for mobile */
        }

        @media (min-width: 1024px) {
            body { cursor: none; }
            #cursor { display: block; }
        }

        /* WATERMARK */
        #paidWatermark {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-35deg);
            font-size: clamp(60px, 15vw, 150px); font-weight: 900; color: rgba(0, 242, 255, 0.08);
            border: 10px solid rgba(0, 242, 255, 0.08); padding: 10px 30px;
            pointer-events: none; text-transform: uppercase; white-space: nowrap; z-index: 50; display: none;
        }

        /* A4 PRINT ARCHITECTURE */
        @media print {
            @page { size: A4; margin: 0; }
            .no-print { display: none !important; }
            body { background: white !important; color: black !important; padding: 0 !important; cursor: default !important; }
            #cursor { display: none !important; }
            .bg-grid { display: none !important; }
            #invoice { width: 210mm !important; height: 297mm !important; padding: 15mm !important; margin: 0 !important; box-shadow: none !important; }
            #paidWatermark { color: rgba(0, 0, 0, 0.05); border-color: rgba(0, 0, 0, 0.05); display: block !important; }
            .print-color { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        }

        .bg-grid {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
                              linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
            background-size: 40px 40px; z-index: -1;
        }

        /* Mobile Scroll Protection for Invoice */
        .invoice-wrapper { overflow-x: auto; width: 100%; -webkit-overflow-scrolling: touch; }
    </style>
</head>
<body class="p-4 md:p-10">
    <div id="cursor"></div>
    <div class="bg-grid"></div>

    <div class="max-w-[1400px] mx-auto grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-10 items-start">
        
        <div class="no-print space-y-6 bg-zinc-900/90 p-6 md:p-8 rounded-2xl border border-white/5 backdrop-blur-xl h-fit lg:sticky lg:top-10">
            <div class="flex justify-between items-center border-b border-white/10 pb-4">
                <h2 class="text-xl font-black uppercase italic tracking-tighter">System Console</h2>
                <button onclick="exportPDF()" class="bg-white text-black px-6 py-2 rounded font-black text-[10px] uppercase tracking-widest transition hover:bg-cyan-400 active:scale-95">Export A4 PDF</button>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div class="bg-zinc-800/50 p-4 rounded-xl border border-white/5 flex flex-col justify-center gap-2">
                    <span class="text-[9px] font-bold uppercase tracking-widest text-zinc-400">Payment Status</span>
                    <button id="togglePaidBtn" onclick="togglePaid()" class="w-full py-2 border border-zinc-600 text-zinc-500 rounded font-bold text-[9px] uppercase tracking-widest">Unpaid</button>
                </div>
                <div class="bg-zinc-800/50 p-4 rounded-xl border border-white/5 flex flex-col justify-center gap-2">
                    <span class="text-[9px] font-bold uppercase tracking-widest text-zinc-400">Statement Date</span>
                    <input id="dateInput" type="date" class="w-full bg-black border border-white/10 p-2 rounded text-xs text-white outline-none">
                </div>
            </div>

            <div class="bg-black/40 p-5 rounded-xl border border-white/5 space-y-4">
                <p class="text-[9px] text-cyan-500 font-bold uppercase tracking-[3px]">Add to Repository</p>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <input id="newServiceName" type="text" placeholder="Service Name" class="bg-zinc-900 border border-white/10 p-2 rounded text-xs outline-none focus:border-cyan-500">
                    <input id="newServicePrice" type="text" placeholder="Price (PKR)" class="bg-zinc-900 border border-white/10 p-2 rounded text-xs outline-none">
                </div>
                <textarea id="newServiceTerms" placeholder="T&C's for this service..." class="w-full bg-zinc-900 border border-white/10 p-2 rounded text-xs h-16 outline-none"></textarea>
                <button onclick="createNewService()" class="w-full py-2 border border-green-500/30 text-green-500 text-[9px] font-bold uppercase tracking-widest active:bg-green-500 active:text-black">Store in Repository</button>
            </div>

            <div class="space-y-4">
                <p class="text-[9px] text-cyan-500 font-bold uppercase tracking-[3px]">Document Builder</p>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <input id="clientName" type="text" placeholder="Client Name" class="bg-black border border-white/10 p-3 rounded text-sm outline-none">
                    <input id="invoiceID" type="text" value="AA-2026-001" class="bg-black border border-white/10 p-3 rounded text-sm outline-none">
                </div>
                <div class="flex flex-col sm:flex-row gap-2">
                    <select id="serviceSelect" class="flex-1 bg-black border border-white/10 p-3 rounded text-sm outline-none cursor-pointer"></select>
                    <button onclick="addItemToBill()" class="px-6 py-3 sm:py-0 bg-zinc-800 text-white rounded font-black uppercase text-[10px] tracking-widest">Add Item</button>
                </div>
            </div>

            <div class="pt-4 border-t border-white/10">
                <h3 class="text-[9px] font-bold text-zinc-500 uppercase mb-3 tracking-widest">System Repository</h3>
                <div id="rulesSettings" class="space-y-3 max-h-[200px] overflow-y-auto pr-2"></div>
            </div>
        </div>

        <div class="invoice-wrapper">
            <div id="invoice" class="bg-white text-black p-8 md:p-16 shadow-2xl flex flex-col relative w-full aspect-[1/1.414] overflow-hidden min-w-[320px]">
                <div id="paidWatermark">Paid</div>

                <div class="flex flex-col sm:flex-row justify-between items-start mb-12 sm:mb-20 gap-6">
                    <div>
                        <img src="AA new logo transparent.png" alt="Logo" class="h-16 md:h-20 mb-6 md:mb-10 grayscale brightness-0">
                        <h1 class="text-[32px] md:text-[44px] font-black tracking-tighter uppercase leading-[0.8] flex flex-col items-start">
                            <span>Affan Arts</span>
                            <span class="text-zinc-200 mt-1">Statements</span>
                        </h1>
                    </div>
                    <div class="text-left sm:text-right">
                        <div class="mb-4">
                            <p class="text-[9px] font-bold uppercase tracking-[3px] text-zinc-300 mb-1">Date Issued</p>
                            <p id="displayDate" class="text-sm font-bold"></p>
                        </div>
                        <div>
                            <p class="text-[9px] font-bold uppercase tracking-[3px] text-zinc-300 mb-1">Reference</p>
                            <p id="displayInvoiceID" class="text-sm font-mono font-bold uppercase">#AA-2026-001</p>
                        </div>
                    </div>
                </div>

                <div class="mb-8 md:mb-12">
                    <p class="text-[9px] font-bold uppercase tracking-[3px] text-zinc-300 mb-2">Billed To</p>
                    <h4 id="displayClient" class="text-xl md:text-2xl font-black uppercase tracking-tight">Valued Client</h4>
                </div>

                <div class="flex-grow">
                    <div class="grid grid-cols-12 border-b-2 md:border-b-4 border-black pb-3 mb-6">
                        <div class="col-span-7 sm:col-span-8 text-[9px] md:text-[10px] font-black uppercase tracking-[2px] md:tracking-[4px]">Service</div>
                        <div class="col-span-5 sm:col-span-4 text-right text-[9px] md:text-[10px] font-black uppercase tracking-[2px] md:tracking-[4px]">Amount</div>
                    </div>
                    <div id="displayItems" class="space-y-4 md:space-y-6"></div>
                    
                    <div class="grid grid-cols-12 mt-10 border-t-2 border-zinc-100 pt-6">
                        <div class="col-span-7 sm:col-span-8 flex items-center">
                            <span class="text-[9px] md:text-[10px] font-black uppercase tracking-[3px] md:tracking-[4px] text-zinc-400 leading-tight">Total Strategic Investment</span>
                        </div>
                        <div class="col-span-5 sm:col-span-4 text-right">
                            <span class="text-xl md:text-3xl font-black text-black" id="totalAmount">PKR 0</span>
                        </div>
                    </div>
                </div>

                <div class="mt-12 md:mt-16 pt-6 md:pt-8 border-t border-zinc-100">
                    <div id="displayTerms" class="grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-4 text-[8px] md:text-[9px] leading-relaxed text-zinc-500 italic"></div>
                </div>

                <div class="mt-10 md:mt-12 flex justify-between items-end">
                    <div class="text-[6px] md:text-[7px] uppercase tracking-[2px] md:tracking-[3px] leading-loose font-bold opacity-30">
                        affanarts.design@gmail.com • +92 329 1904060 <br>
                        Strategic Visual Solutions • Multan, PK
                    </div>
                    <div class="flex flex-col items-center">
                        <div class="w-20 h-20 md:w-28 md:h-28 border-2 border-zinc-100 rounded-full flex items-center justify-center p-2 overflow-hidden bg-zinc-50/50 print-color">
                            <img src="AA logo with name.png" class="w-full h-auto object-contain opacity-100">
                        </div>
                        <p class="text-[7px] md:text-[8px] font-black uppercase tracking-[4px] mt-2 md:mt-3 text-zinc-400">Authorized Release</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Only run mouse cursor on Desktop
        const cursor = document.getElementById('cursor');
        if (window.matchMedia("(min-width: 1024px)").matches) {
            document.addEventListener('mousemove', e => { 
                cursor.style.left = e.clientX + 'px'; 
                cursor.style.top = e.clientY + 'px'; 
            });
        }

        let isPaid = false;
        function togglePaid() {
            isPaid = !isPaid;
            const watermark = document.getElementById('paidWatermark');
            const btn = document.getElementById('togglePaidBtn');
            if(isPaid) {
                watermark.style.display = 'block';
                btn.textContent = 'PAID';
                btn.className = 'w-full py-2 bg-green-500 text-black rounded font-bold text-[9px] uppercase tracking-widest';
            } else {
                watermark.style.display = 'none';
                btn.textContent = 'UNPAID';
                btn.className = 'w-full py-2 border border-zinc-600 text-zinc-500 rounded font-bold text-[9px] uppercase tracking-widest';
            }
        }

        const defaultServices = {
            "Logo Design": { price: "5000", terms: "3 Concepts. 2 Revision rounds. Final AI/SVG files." },
            "Stationery Suite": { price: "7500", terms: "Matches Invoice, Delivery Note, and Letterhead." }
        };

        let services = JSON.parse(localStorage.getItem('aa_billing_v8_2')) || defaultServices;
        let activeItems = [];

        function init() {
            const select = document.getElementById('serviceSelect');
            const rulesContainer = document.getElementById('rulesSettings');
            const dateInput = document.getElementById('dateInput');
            dateInput.value = new Date().toISOString().split('T')[0];

            select.innerHTML = ''; rulesContainer.innerHTML = '';
            Object.keys(services).sort().forEach(s => {
                let opt = document.createElement('option');
                opt.value = s; opt.textContent = s;
                select.appendChild(opt);

                let card = document.createElement('div');
                card.className = "bg-black/60 p-3 rounded-lg border border-white/5 space-y-2 group";
                card.innerHTML = `
                    <div class="flex justify-between items-center">
                        <span class="text-[9px] font-bold text-white uppercase">${s}</span>
                        <div class="flex items-center gap-2">
                            <input type="text" value="${services[s].price}" onchange="updateGlobalItem('${s}', 'price', this.value)" 
                            class="bg-zinc-900 border border-white/10 text-[10px] text-cyan-400 p-1 rounded w-16 text-right outline-none">
                            <button onclick="deleteService('${s}')" class="text-red-900 active:text-red-500 text-[10px]">×</button>
                        </div>
                    </div>
                    <textarea onchange="updateGlobalItem('${s}', 'terms', this.value)" 
                    class="w-full bg-zinc-900 p-2 text-[9px] text-zinc-600 rounded h-10 outline-none border border-white/10">${services[s].terms}</textarea>
                `;
                rulesContainer.appendChild(card);
            });
            renderInvoice();
        }

        function createNewService() {
            const name = document.getElementById('newServiceName').value.trim();
            const price = document.getElementById('newServicePrice').value.trim();
            const terms = document.getElementById('newServiceTerms').value.trim();
            if(!name || !price) return alert("Requires Name and Price.");
            services[name] = { price: price, terms: terms || "Standard terms apply." };
            localStorage.setItem('aa_billing_v8_2', JSON.stringify(services));
            document.getElementById('newServiceName').value = '';
            document.getElementById('newServicePrice').value = '';
            document.getElementById('newServiceTerms').value = '';
            init();
        }

        function deleteService(name) {
            if(confirm(`Remove ${name}?`)) { 
                delete services[name]; 
                localStorage.setItem('aa_billing_v8_2', JSON.stringify(services)); 
                init(); 
            }
        }

        function updateGlobalItem(service, field, newVal) {
            services[service][field] = newVal;
            localStorage.setItem('aa_billing_v8_2', JSON.stringify(services));
            renderInvoice();
        }

        function addItemToBill() {
            const sName = document.getElementById('serviceSelect').value;
            activeItems.push({ name: sName, price: services[sName].price, terms: services[sName].terms });
            renderInvoice();
        }

        function renderInvoice() {
            const dateInput = document.getElementById('dateInput').value;
            const displayDate = document.getElementById('displayDate');
            const itemsList = document.getElementById('displayItems');
            const termsList = document.getElementById('displayTerms');
            const totalDisplay = document.getElementById('totalAmount');
            if(dateInput) {
                const parts = dateInput.split('-');
                displayDate.textContent = `${parts[2]}/${parts[1]}/${parts[0]}`;
            }
            document.getElementById('displayClient').textContent = document.getElementById('clientName').value || "Valued Client";
            document.getElementById('displayInvoiceID').textContent = "#" + document.getElementById('invoiceID').value;
            itemsList.innerHTML = ''; termsList.innerHTML = '';
            let runningTotal = 0;
            activeItems.forEach((item, i) => {
                let numericPrice = parseFloat(item.price.replace(/,/g, '')) || 0;
                runningTotal += numericPrice;
                itemsList.innerHTML += `
                    <div class="grid grid-cols-12 items-center group relative border-b border-zinc-50 pb-2">
                        <div class="col-span-7 sm:col-span-8">
                            <h5 class="font-black uppercase text-sm md:text-lg leading-tight">${item.name}</h5>
                            <button onclick="activeItems.splice(${i},1); renderInvoice();" class="text-[7px] text-red-500 uppercase font-bold md:opacity-0 md:group-hover:opacity-100">Remove</button>
                        </div>
                        <div class="col-span-5 sm:col-span-4 text-right font-black text-sm md:text-xl tracking-tighter">PKR ${numericPrice.toLocaleString()}</div>
                    </div>
                `;
                termsList.innerHTML += `<div><span class="font-black text-black uppercase block mb-1 underline">${item.name}</span>${item.terms}</div>`;
            });
            totalDisplay.textContent = `PKR ${runningTotal.toLocaleString()}`;
        }

        function exportPDF() {
            const id = document.getElementById('invoiceID').value || "000";
            const client = document.getElementById('clientName').value || "ValuedClient";
            const cleanClient = client.replace(/\s+/g, '_').replace(/[^a-zA-Z0-9_]/g, '');
            const cleanID = id.replace(/\s+/g, '_').replace(/[^a-zA-Z0-9_]/g, '');
            const originalTitle = document.title;
            document.title = `AA_STMT_${cleanID}_${cleanClient}`; 
            window.print();
            setTimeout(() => { document.title = originalTitle; }, 500);
        }

        document.getElementById('clientName').oninput = renderInvoice;
        document.getElementById('invoiceID').oninput = renderInvoice;
        document.getElementById('dateInput').onchange = renderInvoice;
        init();
    </script>
</body>
</html>
